@using MarkdownRepository.Lib
@{
    ViewBag.Title = "Search";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section style{
<style>
    .search-box{ margin-top:2em; }
    .search-box .form-group { width: 75%; }
    .search-box .form-group input{ width:100%; }
    .search-list 
    {
        margin: 0.8em 0 0.7em 1em;
        list-style: none;
        background-color: #f9f9f9;
        padding: 0.5em;
        border-radius: 5px; 
    }
    .update-time
    {
        font-size: 0.7em;
        color: gray;
        font-family: sans-serif;
    }
    .category{ padding-left:1em; color:#337ab7; font-size:0.8em;}
</style>
}

@model List<MarkdownRepository.Models.Document>

@using (Html.BeginForm("Search", "Document", FormMethod.Get, new { @class = "form-inline col-sm-offset-2 search-box", @role = "form" }))
{ 
    <div class="form-group">
        @Html.TextBox("searchText", ViewBag.CurrentFilter as string, new { @class = "form-control", @placeholder = "Search Text" })
    </div>
    <button type="submit" class="btn btn-primary"><span class="glyphicon glyphicon-search"></span>Search</button>
}

<div style="min-height:600px;">
    <ul style="padding-left:0">
        @if (Model != null)
        {
            foreach (var item in Model)
            { 
            <li class="search-list">
                @if(item.creator.Equals(User.Identity.Name.GetUserName(), StringComparison.InvariantCultureIgnoreCase)){
                    
                <div class="pull-right" style="font-size:0.7em;" >
                    <a href="@Url.Action("Create", new { id = item.rowid })"><span class="glyphicon glyphicon-edit"></span> 修改</a> 
                    <a href="javascript:deleteDoc('@item.rowid')"><span class="glyphicon glyphicon-trash"></span> 删除</a>
                </div>
                    
                }
                
                <div>
                    <a href="@Url.Action("Show", new { id = item.rowid })">
                        <h4>@Html.Raw(item.title)</h4>  
                        <p style="text-overflow: ellipsis; word-wrap: break-word; font-size: 0.7em; color: gray; margin: 1em;">
                            @Html.Raw(item.content)
                        </p>
                    </a>
                </div>

                <div class="category">
                    @Html.Raw(item.category)
                </div>

                <div class="update-time">
                    Create by: @AdAccount.GetUserNameById(item.creator), Updated time: @item.update_at
                </div>          
            </li>
            }
        }
    </ul>
</div>

@section scripts{

    <script>
    function deleteDoc(id){
        if (confirm("确认删除?")) {
            $.ajax({
                type: "POST",
                url: "@Url.Action("Delete","Document")",
                data: { id: id },

                success: function (data) {
                    if(data.success){
                        location.reload();
                    }else{
                        alert(data.message);
                    }
                }
            });
        }
    }

    </script>
}