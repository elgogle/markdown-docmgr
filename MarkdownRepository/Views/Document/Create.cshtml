@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@model MarkdownRepository.Models.Document
@{
    var doc = Model ?? new MarkdownRepository.Models.Document() ;    
}

<div id="message" class=""></div>

<input id="docId" type="hidden" value="@doc.rowid" />

<label style="font-size:0.8em">Title
    <input id="title" class="form-control col-sm-4"  type="text" value="@doc.title" class="" />
</label>

<label style="font-size:0.8em">Category
    <input id="category" class="form-control col-sm-4" placeholder="',' as delimeter" type="text" value="@doc.category" class="" />
</label>

<button id="btnSave" class="btn btn-default pull-right"><span class="glyphicon glyphicon-floppy-save" aria-hidden="true"></span> Save</button>

<div id="mkEditor">
    <textarea style="display:none;">@doc.content</textarea>
</div>

@section style{
    @System.Web.Optimization.Styles.Render("~/css/editor.md")
}

@section scripts{

@System.Web.Optimization.Scripts.Render("~/script/editor.md")

    <script>
        $(function () {
            editormd("mkEditor", {
                width: "100%",
                height: 640,
                saveHTMLToTextarea: true,
                autoLoadModules: false,
                imageUpload: true,
                imageFormats: ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
                imageUploadURL: '@Url.Action("UploadImage", "Document")',
                pluginPath: '@Url.Content("~/editor.md/plugins/")'
            });


            $("#btnSave").on('click', function () {
                $.post('@Url.Action("Create", "Document")',
                    {
                        content: $("#mkEditor > textarea").val(),
                        title: $("#title").val(),
                        category: $("#category").val(),
                        id: $("#docId").val()
                    },
                    function (result) {
                        $("#docId").val(result.rowid);
                        $("#message")
                        .html("<span style='pading:0.5em;background-color:green;color:#fff;font-size:0.75em'>Saved</span>")
                        .animate({ opacity: 0 }, 5000, function () { $(this).html("").css("opacity", "1"); });
                    });
                return false;
            });

            $(document).on('keydown', function (e) {
                var ctrlKey = e.ctrlKey || e.metaKey;
                if (ctrlKey) {
                    var keyCode = e.keyCode || e.which || e.charCode;
                    // ctrl+s
                    if (ctrlKey && keyCode == 83) {
                        $('#btnSave').trigger('click');
                        e.preventDefault();
                        return false;
                    }
                }
            });

        });    
    </script>
}